/* Type 2 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD, cc.LEG_1_FF, cc.LEG_2_FF,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 2 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
inner join
(select * from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
on aa.instr_id = cc.instr_id and aa.date_id = cc.date_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 3 */
SELECT rawdata.INSTR_ID, rawdata.TYPE,
        rawdata.HORIZON,  
        target.BUY_CCY, target.SELL_CCY,
        rawdata.FORWARD_VALUE, rawdata.MARKET_VALUE, rawdata.SHOCK
FROM
(SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE TYPE <> 80 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, CVA+DVA FORWARD_VALUE
    FROM CVADIM.AVG_EXPOSURE
    WHERE HORIZON_ID = 1 AND SCENARIO_ID = 'Base' AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT a.INSTR_ID, a.DATE_ID, a.FORWARD_VALUE 
FROM (        
    SELECT INSTR_ID, DATE_ID, MARKET_VALUE FORWARD_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID IN (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
     ) a
    LEFT JOIN (
    SELECT INSTR_ID, DATE_ID
    FROM CVADIM.AVG_EXPOSURE
    WHERE SCENARIO_ID = 'Base' and HORIZON_ID = 1
    )  b
    ON a.DATE_ID = b.DATE_ID
        AND a.INSTR_ID = b.INSTR_ID
    WHERE b.DATE_ID IS NULL
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID) rawdata
INNER JOIN
(SELECT INSTR_ID, DATE_ID, BUY_CCY, SELL_CCY 
FROM PFEDIM.FXR_POSITION) target
ON rawdata.instr_ID = target.instr_ID and rawdata.pfe = target.date_id;

/* Type 5 and 7 */
SELECT rawdata.INSTR_ID, rawdata.TYPE,
        rawdata.HORIZON, target.SUB_TYPE, 
        target.BUY_CCY, target.SELL_CCY,
        target.INS_B_S_CODE, target.CALL_PUT, 
        rawdata.FORWARD_VALUE, rawdata.MARKET_VALUE, rawdata.SHOCK
FROM
(SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE TYPE <> 80 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, CVA+DVA FORWARD_VALUE
    FROM CVADIM.AVG_EXPOSURE
    WHERE HORIZON_ID = 1 AND SCENARIO_ID = 'Base' AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID pfe, aa.DATE_ID mtm,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT a.INSTR_ID, a.DATE_ID, a.FORWARD_VALUE 
FROM (        
    SELECT INSTR_ID, DATE_ID, MARKET_VALUE FORWARD_VALUE
    FROM PFEDIM.POSITION
    WHERE (TYPE = 3 OR TYPE = 21 OR TYPE = 22) AND DATE_ID IN (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
     ) a
    LEFT JOIN (
    SELECT INSTR_ID, DATE_ID
    FROM CVADIM.AVG_EXPOSURE
    WHERE SCENARIO_ID = 'Base' and HORIZON_ID = 1
    )  b
    ON a.DATE_ID = b.DATE_ID
        AND a.INSTR_ID = b.INSTR_ID
    WHERE b.DATE_ID IS NULL
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID) rawdata
INNER JOIN
(SELECT INSTR_ID, DATE_ID, SUB_TYPE, BUY_CCY, 
       SELL_CCY, INS_B_S_CODE, CALL_PUT
FROM PFEDIM.FXO_POSITION) target
ON rawdata.instr_ID = target.instr_ID and rawdata.pfe = target.date_id;

/* Type 8 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.ins_b_s_code, cc.ins_put_call_code, cc.UNDERLYING, bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK 
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE
    FROM PFEDIM.POSITION
    WHERE TYPE = 8 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INS_PUT_CALL_CODE, a.UNDERLYING from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 9 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD, 
       cc.LEG_1_FF, cc.LEG_2_FF,
       bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK 
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R
    FROM PFEDIM.POSITION
    WHERE TYPE = 9 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INS_PUT_CALL_CODE, a.UNDERLYING,
a.INST_LEG2_REF_INTRATE_INDX_COD, a.LEG_1_FF, a.LEG_2_FF from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type_10 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.ins_b_s_code, aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD,
       aa.LEG_1_FF, aa.LEG_2_FF, bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK 
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 10 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INS_PUT_CALL_CODE,
a.UNDERLYING, a.INST_LEG2_REF_INTRATE_INDX_COD from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;
   
/* Type_11 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.ins_b_s_code, cc.ccy1, cc.ccy2, bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK 
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, CCY
    FROM PFEDIM.POSITION
    WHERE TYPE = 11 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INSTR_LEG1_NAT_CCY_CODE CCY1,
    a.INSTR_LEG2_NAT_CCY_CODE CCY2 from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 13 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 13 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
inner join
(select * from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
on aa.instr_id = cc.instr_id and aa.date_id = cc.date_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 14 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 14 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
inner join
(select * from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
on aa.instr_id = cc.instr_id and aa.date_id = cc.date_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 15 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 15 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
inner join
(select * from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
on aa.instr_id = cc.instr_id and aa.date_id = cc.date_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 16 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, cc.UNDERLYING, cc.INST_LEG2_REF_INTRATE_INDX_COD,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 16 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
inner join
(select * from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
on aa.instr_id = cc.instr_id and aa.date_id = cc.date_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 17 */
SELECT aa.INSTR_ID, aa.TYPE, 
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, aa.LEG_1_FF, aa.LEG_2_FF,
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 17 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID;

/* Type_18 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.ins_b_s_code, cc.INS_PUT_CALL_CODE, cc.UNDERLYING,
       cc.INST_LEG2_REF_INTRATE_INDX_COD, bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
       from;
       
select * from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 18 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INS_PUT_CALL_CODE from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;


/* Type 19 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.INS_B_S_CODE, bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 19 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;

/* Type 20 */
select aa.INSTR_ID, aa.TYPE,
       TO_CHAR(ee.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON,
       cc.ins_b_s_code, aa.P_R, cc.UNDERLYING, 
       cc.INST_LEG2_REF_INTRATE_INDX_COD, aa.LEG_1_FF, aa.LEG_2_FF, 
       bb.FORWARD_VALUE, aa.MARKET_VALUE, 
       aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK 
       from
(SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 20 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
inner join
(select b.instr_id, c.date_id, a.INS_B_S_CODE, a.INS_PUT_CALL_CODE,
a.UNDERLYING, a.INST_LEG2_REF_INTRATE_INDX_COD  from
(select * from PFESTG2.STG_MUREX_POS_DATA) a
inner join
(select * from pfedim.position_mapping) b
on a.VALUABLE_ID = B.SOURCE_SYSTEM_INSTRUMENT_ID
inner join
(select * from pfedim.calendar_date) c
on a.as_of_date = c.calendar_date) cc
ON bb.date_id = cc.date_id
and aa.instr_id = cc.instr_id
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON aa.DATE_ID = dd.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE ee
ON bb.DATE_ID = ee.DATE_ID;


/* Type 21 */
SELECT aaa.INSTR_ID, aaa.TYPE, aaa.HORIZON, bbb.UNDERLYING_INDEX, 
       bbb.CALL_PUT, bbb.INS_B_S_CODE, bbb.M_INSTRUMENT, aaa.P_R, aaa.LEG_1_FF, 
       aaa.LEG_2_FF, aaa.FORWARD_VALUE, aaa.MARKET_VALUE, aaa.SHOCK
FROM
(SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, aa.LEG_1_FF, aa.LEG_2_FF, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 21 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, CVA+DVA FORWARD_VALUE
    FROM CVADIM.AVG_EXPOSURE
    WHERE HORIZON_ID = 1 AND SCENARIO_ID = 'Base' AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, aa.LEG_1_FF, aa.LEG_2_FF, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 21 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT a.INSTR_ID, a.DATE_ID, a.FORWARD_VALUE 
FROM (        
    SELECT INSTR_ID, DATE_ID, MARKET_VALUE FORWARD_VALUE
    FROM PFEDIM.POSITION
    WHERE TYPE = 21 AND DATE_ID IN (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
     ) a
    LEFT JOIN (
    SELECT INSTR_ID, DATE_ID
    FROM CVADIM.AVG_EXPOSURE
    WHERE SCENARIO_ID = 'Base' and HORIZON_ID = 1
    )  b
    ON a.DATE_ID = b.DATE_ID
        AND a.INSTR_ID = b.INSTR_ID
    WHERE b.DATE_ID IS NULL
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID) aaa
INNER JOIN PFEDIM.COMMODITY_POSITION bbb
ON aaa.INSTR_ID = bbb.INSTR_ID 
    AND aaa.DATE_ID = bbb.DATE_ID;

/* Type 22 */
SELECT aaa.INSTR_ID, aaa.TYPE, aaa.HORIZON, bbb.UNDERLYING_INDEX, 
       bbb.CALL_PUT, bbb.INS_B_S_CODE, bbb.M_INSTRUMENT, aaa.P_R, aaa.LEG_1_FF, 
       aaa.LEG_2_FF, aaa.FORWARD_VALUE, aaa.MARKET_VALUE, aaa.SHOCK
FROM
(SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, aa.LEG_1_FF, aa.LEG_2_FF, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 22 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, CVA+DVA FORWARD_VALUE
    FROM CVADIM.AVG_EXPOSURE
    WHERE HORIZON_ID = 1 AND SCENARIO_ID = 'Base' AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID
UNION
SELECT aa.INSTR_ID, aa.TYPE, bb.DATE_ID,
        TO_CHAR(dd.CALENDAR_DATE, 'mm/dd/yyyy') || ' - ' || TO_CHAR(cc.CALENDAR_DATE, 'mm/dd/yyyy') HORIZON, 
        aa.P_R, aa.LEG_1_FF, aa.LEG_2_FF, 
        bb.FORWARD_VALUE, aa.MARKET_VALUE, aa.MARKET_VALUE - bb.FORWARD_VALUE SHOCK
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, MARKET_VALUE, LEG_1_PAY_REC_CODE P_R, LEG_1_FF, LEG_2_FF
    FROM PFEDIM.POSITION
    WHERE TYPE = 22 AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT a.INSTR_ID, a.DATE_ID, a.FORWARD_VALUE 
FROM (        
    SELECT INSTR_ID, DATE_ID, MARKET_VALUE FORWARD_VALUE
    FROM PFEDIM.POSITION
    WHERE TYPE = 22 AND DATE_ID IN (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
     ) a
    LEFT JOIN (
    SELECT INSTR_ID, DATE_ID
    FROM CVADIM.AVG_EXPOSURE
    WHERE SCENARIO_ID = 'Base' and HORIZON_ID = 1
    )  b
    ON a.DATE_ID = b.DATE_ID
        AND a.INSTR_ID = b.INSTR_ID
    WHERE b.DATE_ID IS NULL
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID    
INNER JOIN PFEDIM.CALENDAR_DATE cc
ON aa.DATE_ID = cc.DATE_ID
INNER JOIN PFEDIM.CALENDAR_DATE dd
ON bb.DATE_ID = dd.DATE_ID) aaa
INNER JOIN PFEDIM.COMMODITY_POSITION bbb
ON aaa.INSTR_ID = bbb.INSTR_ID 
    AND aaa.DATE_ID = bbb.DATE_ID;