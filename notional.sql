/* Get the notionals */ 

SELECT aa.INSTR_ID, aa.TYPE, AA.notional
FROM (
    SELECT INSTR_ID, TYPE, DATE_ID, notional
    FROM PFEDIM.POSITION
    WHERE TYPE in (2,9) AND DATE_ID in (18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18380, 18389, 18399, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509, 18518)
    ) aa
INNER JOIN (
    SELECT INSTR_ID, DATE_ID, VALUE FORWARD_VALUE
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    ) bb
ON aa.DATE_ID BETWEEN bb.DATE_ID + 1 AND bb.DATE_ID + 13
    AND aa.INSTR_ID = bb.INSTR_ID
INNER JOIN (
    SELECT INSTR_ID, MIN(DATE_ID) as date_id
    FROM PFEDIM.FORWARD_VALUE
    WHERE HORIZON_ID = 1 AND DATE_ID in (18130, 18138, 18148, 18157, 18167, 18176, 
            18186, 18196, 18205, 18215, 18225, 18235, 18244, 18254, 18264, 18274, 
            18284, 18294, 18304, 18313, 18323, 18333, 18342, 18352, 18361, 18370, 
            18381, 18390, 18402, 18412, 18421, 18431, 18441, 18450, 18460, 18470, 
            18480, 18490, 18499, 18509)
    GROUP BY INSTR_ID
    ) cc
ON bb.date_id = cc.date_id and bb.instr_id = cc.instr_id;
